<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to Splatter • Splatter</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Introduction to Splatter">
<meta property="og:description" content="splatter">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-52309538-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-52309538-4');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Splatter</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.13.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/splatter.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/splat_params.html">Splat simulation parameters</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Oshlack/splatter/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="splatter_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to Splatter</h1>
                        <h4 class="author">Luke Zappia</h4>
            
            <h4 class="date">2020-09-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Oshlack/splatter/blob/master/vignettes/splatter.Rmd"><code>vignettes/splatter.Rmd</code></a></small>
      <div class="hidden name"><code>splatter.Rmd</code></div>

    </div>

    
    
<div class="figure">
<img src="splatter-logo-small.png" alt=""><p class="caption">Splatter logo</p>
</div>
<p>Welcome to Splatter! Splatter is an R package for the simple simulation of single-cell RNA sequencing data. This vignette gives an overview and introduction to Splatter’s functionality.</p>
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<p>Splatter can be installed from Bioconductor:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co">if</span> (<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span>(<span class="st">"BiocManager"</span>, quietly=<span class="fl">TRUE</span>))
    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"BiocManager"</span>)
<span class="kw">BiocManager</span>::<span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span>(<span class="st">"splatter"</span>)
</pre></div>
<p>To install the most recent development version from Github use:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">BiocManager</span>::<span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span>(<span class="st">"Oshlack/splatter"</span>, dependencies = <span class="fl">TRUE</span>,
                     build_vignettes = <span class="fl">TRUE</span>)
</pre></div>
</div>
<div id="quickstart" class="section level1">
<h1 class="hasAnchor">
<a href="#quickstart" class="anchor"></a>Quickstart</h1>
<p>Assuming you already have a matrix of count data similar to that you wish to simulate there are two simple steps to creating a simulated data set with Splatter. Here is an example a mock dataset generated with the <code>scater</code> package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="co"># Load package</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/Oshlack/splatter">splatter</a></span>)
</pre></div>
<pre><code>## Loading required package: SingleCellExperiment</code></pre>
<pre><code>## Loading required package: SummarizedExperiment</code></pre>
<pre><code>## Loading required package: GenomicRanges</code></pre>
<pre><code>## Loading required package: stats4</code></pre>
<pre><code>## Loading required package: BiocGenerics</code></pre>
<pre><code>## Loading required package: parallel</code></pre>
<pre><code>## 
## Attaching package: 'BiocGenerics'</code></pre>
<pre><code>## The following objects are masked from 'package:parallel':
## 
##     clusterApply, clusterApplyLB, clusterCall, clusterEvalQ,
##     clusterExport, clusterMap, parApply, parCapply, parLapply,
##     parLapplyLB, parRapply, parSapply, parSapplyLB</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     IQR, mad, sd, var, xtabs</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     anyDuplicated, append, as.data.frame, basename, cbind, colnames,
##     dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep,
##     grepl, intersect, is.unsorted, lapply, Map, mapply, match, mget,
##     order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,
##     rbind, Reduce, rownames, sapply, setdiff, sort, table, tapply,
##     union, unique, unsplit, which.max, which.min</code></pre>
<pre><code>## Loading required package: S4Vectors</code></pre>
<pre><code>## 
## Attaching package: 'S4Vectors'</code></pre>
<pre><code>## The following object is masked from 'package:base':
## 
##     expand.grid</code></pre>
<pre><code>## Loading required package: IRanges</code></pre>
<pre><code>## Loading required package: GenomeInfoDb</code></pre>
<pre><code>## Loading required package: Biobase</code></pre>
<pre><code>## Welcome to Bioconductor
## 
##     Vignettes contain introductory material; view with
##     'browseVignettes()'. To cite Bioconductor, see
##     'citation("Biobase")', and for packages 'citation("pkgname")'.</code></pre>
<pre><code>## Loading required package: DelayedArray</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## 
## Attaching package: 'Matrix'</code></pre>
<pre><code>## The following object is masked from 'package:S4Vectors':
## 
##     expand</code></pre>
<pre><code>## Loading required package: matrixStats</code></pre>
<pre><code>## 
## Attaching package: 'matrixStats'</code></pre>
<pre><code>## The following objects are masked from 'package:Biobase':
## 
##     anyMissing, rowMedians</code></pre>
<pre><code>## 
## Attaching package: 'DelayedArray'</code></pre>
<pre><code>## The following objects are masked from 'package:matrixStats':
## 
##     colMaxs, colMins, colRanges, rowMaxs, rowMins, rowRanges</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     aperm, apply, rowsum</code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="co"># Create mock data</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://bioconductor.org/packages/scater">scater</a></span>)
</pre></div>
<pre><code>## Loading required package: ggplot2</code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1</span>)
<span class="kw">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/mockSCE.html">mockSCE</a></span>()

<span class="co"># Estimate parameters from mock data</span>
<span class="kw">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/splatEstimate.html">splatEstimate</a></span>(<span class="kw">sce</span>)
</pre></div>
<pre><code>## NOTE: Library sizes have been found to be normally distributed instead of log-normal. You may want to check this is correct.</code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit">
<span class="co"># Simulate data using estimated parameters</span>
<span class="kw">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/splatSimulate.html">splatSimulate</a></span>(<span class="kw">params</span>)
</pre></div>
<pre><code>## Getting parameters...</code></pre>
<pre><code>## Creating simulation object...</code></pre>
<pre><code>## Simulating library sizes...</code></pre>
<pre><code>## Simulating gene means...</code></pre>
<pre><code>## Simulating BCV...</code></pre>
<pre><code>## Simulating counts...</code></pre>
<pre><code>## Simulating dropout (if needed)...</code></pre>
<pre><code>## Done!</code></pre>
<p>These steps will be explained in detail in the following sections but briefly the first step takes a dataset and estimates simulation parameters from it and the second step takes those parameters and simulates a new dataset.</p>
</div>
<div id="the-splat-simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#the-splat-simulation" class="anchor"></a>The Splat simulation</h1>
<p>Before we look at how we estimate parameters let’s first look at how Splatter simulates data and what those parameters are. We use the term ‘Splat’ to refer to the Splatter’s own simulation and differentiate it from the package itself. The core of the Splat model is a gamma-Poisson distribution used to generate a gene by cell matrix of counts. Mean expression levels for each gene are simulated from a <a href="https://en.wikipedia.org/wiki/Gamma_distribution">gamma distribution</a> and the Biological Coefficient of Variation is used to enforce a mean-variance trend before counts are simulated from a <a href="https://en.wikipedia.org/wiki/Poisson_distribution">Poisson distribution</a>. Splat also allows you to simulate expression outlier genes (genes with mean expression outside the gamma distribution) and dropout (random knock out of counts based on mean expression). Each cell is given an expected library size (simulated from a log-normal distribution) that makes it easier to match to a given dataset.</p>
<p>Splat can also simulate differential expression between groups of different types of cells or differentiation paths between different cells types where expression changes in a continuous way. These are described further in the <a href="#simulating-counts">simulating counts</a> section.</p>
</div>
<div id="the-splatparams-object" class="section level1">
<h1 class="hasAnchor">
<a href="#the-splatparams-object" class="anchor"></a>The <code>SplatParams</code> object</h1>
<p>All the parameters for the Splat simulation are stored in a <code>SplatParams</code> object. Let’s create a new one and see what it looks like.</p>
<div class="sourceCode" id="cb44"><pre class="downlit">
<span class="kw">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newParams.html">newSplatParams</a></span>()
<span class="kw">params</span>
</pre></div>
<pre><code>## A Params object of class SplatParams 
## Parameters can be (estimable) or [not estimable], 'Default' or  'NOT DEFAULT' 
## Secondary parameters are usually set during simulation
## 
## Global: 
## (Genes)  (Cells)   [Seed] 
##   10000      100   121054 
## 
## 28 additional parameters 
## 
## Batches: 
##     [Batches]  [Batch Cells]     [Location]        [Scale] 
##             1            100            0.1            0.1 
## 
## Mean: 
##  (Rate)  (Shape) 
##     0.3      0.6 
## 
## Library size: 
## (Location)     (Scale)      (Norm) 
##         11         0.2       FALSE 
## 
## Exprs outliers: 
## (Probability)     (Location)        (Scale) 
##          0.05              4            0.5 
## 
## Groups: 
##      [Groups]  [Group Probs] 
##             1              1 
## 
## Diff expr: 
## [Probability]    [Down Prob]     [Location]        [Scale] 
##           0.1            0.5            0.1            0.4 
## 
## BCV: 
## (Common Disp)          (DoF) 
##           0.1             60 
## 
## Dropout: 
##     [Type]  (Midpoint)     (Shape) 
##       none           0          -1 
## 
## Paths: 
##         [From]         [Steps]          [Skew]    [Non-linear]  [Sigma Factor] 
##              0             100             0.5             0.1             0.8</code></pre>
<p>As well as telling us what type of object we have (“A <code>Params</code> object of class <code>SplatParams</code>”) and showing us the values of the parameter this output gives us some extra information. We can see which parameters can be estimated by the <code>splatEstimate</code> function (those in parentheses), which can’t be estimated (those in brackets) and which have been changed from their default values (those in ALL CAPS). For more details about the parameters of the Splat simulation refer to the <a href="splat_params.html">Splat parameters vignette</a>.</p>
<div id="getting-and-setting" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-and-setting" class="anchor"></a>Getting and setting</h2>
<p>If we want to look at a particular parameter, for example the number of genes to simulate, we can extract it using the <code>getParam</code> function:</p>
<div class="sourceCode" id="cb46"><pre class="downlit">
<span class="fu"><a href="../reference/getParam.html">getParam</a></span>(<span class="kw">params</span>, <span class="st">"nGenes"</span>)
</pre></div>
<pre><code>## [1] 10000</code></pre>
<p>Alternatively, to give a parameter a new value we can use the <code>setParam</code> function:</p>
<div class="sourceCode" id="cb48"><pre class="downlit">
<span class="kw">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setParam.html">setParam</a></span>(<span class="kw">params</span>, <span class="st">"nGenes"</span>, <span class="fl">5000</span>)
<span class="fu"><a href="../reference/getParam.html">getParam</a></span>(<span class="kw">params</span>, <span class="st">"nGenes"</span>)
</pre></div>
<pre><code>## [1] 5000</code></pre>
<p>If we want to extract multiple parameters (as a list) or set multiple parameters we can use the <code>getParams</code> or <code>setParams</code> functions:</p>
<div class="sourceCode" id="cb50"><pre class="downlit">
<span class="co"># Set multiple parameters at once (using a list)</span>
<span class="kw">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setParams.html">setParams</a></span>(<span class="kw">params</span>, update = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(nGenes = <span class="fl">8000</span>, mean.rate = <span class="fl">0.5</span>))
<span class="co"># Extract multiple parameters as a list</span>
<span class="fu"><a href="../reference/getParams.html">getParams</a></span>(<span class="kw">params</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"nGenes"</span>, <span class="st">"mean.rate"</span>, <span class="st">"mean.shape"</span>))
</pre></div>
<pre><code>## $nGenes
## [1] 8000
## 
## $mean.rate
## [1] 0.5
## 
## $mean.shape
## [1] 0.6</code></pre>
<div class="sourceCode" id="cb52"><pre class="downlit">
<span class="co"># Set multiple parameters at once (using additional arguments)</span>
<span class="kw">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setParams.html">setParams</a></span>(<span class="kw">params</span>, mean.shape = <span class="fl">0.5</span>, de.prob = <span class="fl">0.2</span>)
<span class="kw">params</span>
</pre></div>
<pre><code>## A Params object of class SplatParams 
## Parameters can be (estimable) or [not estimable], 'Default' or  'NOT DEFAULT' 
## Secondary parameters are usually set during simulation
## 
## Global: 
## (GENES)  (Cells)   [Seed] 
##    8000      100   121054 
## 
## 28 additional parameters 
## 
## Batches: 
##     [Batches]  [Batch Cells]     [Location]        [Scale] 
##             1            100            0.1            0.1 
## 
## Mean: 
##  (RATE)  (SHAPE) 
##     0.5      0.5 
## 
## Library size: 
## (Location)     (Scale)      (Norm) 
##         11         0.2       FALSE 
## 
## Exprs outliers: 
## (Probability)     (Location)        (Scale) 
##          0.05              4            0.5 
## 
## Groups: 
##      [Groups]  [Group Probs] 
##             1              1 
## 
## Diff expr: 
## [PROBABILITY]    [Down Prob]     [Location]        [Scale] 
##           0.2            0.5            0.1            0.4 
## 
## BCV: 
## (Common Disp)          (DoF) 
##           0.1             60 
## 
## Dropout: 
##     [Type]  (Midpoint)     (Shape) 
##       none           0          -1 
## 
## Paths: 
##         [From]         [Steps]          [Skew]    [Non-linear]  [Sigma Factor] 
##              0             100             0.5             0.1             0.8</code></pre>
<p>The parameters with have changed are now shown in ALL CAPS to indicate that they been changed form the default.</p>
<p>We can also set parameters directly when we call <code>newSplatParams</code>:</p>
<div class="sourceCode" id="cb54"><pre class="downlit">
<span class="kw">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newParams.html">newSplatParams</a></span>(lib.loc = <span class="fl">12</span>, lib.scale = <span class="fl">0.6</span>)
<span class="fu"><a href="../reference/getParams.html">getParams</a></span>(<span class="kw">params</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lib.loc"</span>, <span class="st">"lib.scale"</span>))
</pre></div>
<pre><code>## $lib.loc
## [1] 12
## 
## $lib.scale
## [1] 0.6</code></pre>
</div>
</div>
<div id="estimating-parameters" class="section level1">
<h1 class="hasAnchor">
<a href="#estimating-parameters" class="anchor"></a>Estimating parameters</h1>
<p>Splat allows you to estimate many of it’s parameters from a data set containing counts using the <code>splatEstimate</code> function.</p>
<div class="sourceCode" id="cb56"><pre class="downlit">
<span class="co"># Get the mock counts matrix</span>
<span class="kw">counts</span> <span class="op">&lt;-</span> <span class="fu">counts</span>(<span class="kw">sce</span>)

<span class="co"># Check that counts is an integer matrix</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="kw">counts</span>)
</pre></div>
<pre><code>## [1] "matrix" "array"</code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/typeof.html">typeof</a></span>(<span class="kw">counts</span>)
</pre></div>
<pre><code>## [1] "double"</code></pre>
<div class="sourceCode" id="cb60"><pre class="downlit">
<span class="co"># Check the dimensions, each row is a gene, each column is a cell</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="kw">counts</span>)
</pre></div>
<pre><code>## [1] 2000  200</code></pre>
<div class="sourceCode" id="cb62"><pre class="downlit">
<span class="co"># Show the first few entries</span>
<span class="kw">counts</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]
</pre></div>
<pre><code>##           Cell_001 Cell_002 Cell_003 Cell_004 Cell_005
## Gene_0001        0        5        7      276       50
## Gene_0002       12        0        0        0        0
## Gene_0003       97      292       58       64      541
## Gene_0004        0        0        0      170       19
## Gene_0005      105      123      174      565     1061</code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit">
<span class="kw">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/splatEstimate.html">splatEstimate</a></span>(<span class="kw">counts</span>)
</pre></div>
<pre><code>## NOTE: Library sizes have been found to be normally distributed instead of log-normal. You may want to check this is correct.</code></pre>
<p>Here we estimated parameters from a counts matrix but <code>splatEstimate</code> can also take a <code>SingleCellExperiment</code> object. The estimation process has the following steps:</p>
<ol style="list-style-type: decimal">
<li>Mean parameters are estimated by fitting a gamma distribution to the mean expression levels.</li>
<li>Library size parameters are estimated by fitting a log-normal distribution to the library sizes.</li>
<li>Expression outlier parameters are estimated by determining the number of outliers and fitting a log-normal distribution to their difference from the median.</li>
<li>BCV parameters are estimated using the <code>estimateDisp</code> function from the <code>edgeR</code> package.</li>
<li>Dropout parameters are estimated by checking if dropout is present and fitting a logistic function to the relationship between mean expression and proportion of zeros.</li>
</ol>
<p>For more details of the estimation procedures see <code><a href="../reference/splatEstimate.html">?splatEstimate</a></code>.</p>
</div>
<div id="simulating-counts" class="section level1">
<h1 class="hasAnchor">
<a href="#simulating-counts" class="anchor"></a>Simulating counts</h1>
<p>Once we have a set of parameters we are happy with we can use <code>splatSimulate</code> to simulate counts. If we want to make small adjustments to the parameters we can provide them as additional arguments, alternatively if we don’t supply any parameters the defaults will be used:</p>
<div class="sourceCode" id="cb66"><pre class="downlit">
<span class="kw">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/splatSimulate.html">splatSimulate</a></span>(<span class="kw">params</span>, nGenes = <span class="fl">1000</span>)
</pre></div>
<pre><code>## Getting parameters...</code></pre>
<pre><code>## Creating simulation object...</code></pre>
<pre><code>## Simulating library sizes...</code></pre>
<pre><code>## Simulating gene means...</code></pre>
<pre><code>## Simulating BCV...</code></pre>
<pre><code>## Simulating counts...</code></pre>
<pre><code>## Simulating dropout (if needed)...</code></pre>
<pre><code>## Done!</code></pre>
<div class="sourceCode" id="cb75"><pre class="downlit">
<span class="kw">sim</span>
</pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 1000 200 
## metadata(1): Params
## assays(6): BatchCellMeans BaseCellMeans ... TrueCounts counts
## rownames(1000): Gene1 Gene2 ... Gene999 Gene1000
## rowData names(4): Gene BaseGeneMean OutlierFactor GeneMean
## colnames(200): Cell1 Cell2 ... Cell199 Cell200
## colData names(3): Cell Batch ExpLibSize
## reducedDimNames(0):
## altExpNames(0):</code></pre>
<p>Looking at the output of <code>splatSimulate</code> we can see that <code>sim</code> is <code>SingleCellExperiment</code> object with 1000 features (genes) and 200 samples (cells). The main part of this object is a features by samples matrix containing the simulated counts (accessed using <code>counts</code>), although it can also hold other expression measures such as FPKM or TPM. Additionally a <code>SingleCellExperiment</code> contains phenotype information about each cell (accessed using <code>colData</code>) and feature information about each gene (accessed using <code>rowData</code>). Splatter uses these slots, as well as <code>assays</code>, to store information about the intermediate values of the simulation.</p>
<div class="sourceCode" id="cb77"><pre class="downlit">
<span class="co"># Access the counts</span>
<span class="fu">counts</span>(<span class="kw">sim</span>)[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]
</pre></div>
<pre><code>##       Cell1 Cell2 Cell3 Cell4 Cell5
## Gene1  2803  7799   128  1467  1177
## Gene2   748    56   158   431   878
## Gene3    23    14     0    14     0
## Gene4    50     1    39    69   170
## Gene5  1128   577   870   204  1410</code></pre>
<div class="sourceCode" id="cb79"><pre class="downlit">
<span class="co"># Information about genes</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu">rowData</span>(<span class="kw">sim</span>))
</pre></div>
<pre><code>## DataFrame with 6 rows and 4 columns
##              Gene BaseGeneMean OutlierFactor  GeneMean
##       &lt;character&gt;    &lt;numeric&gt;     &lt;numeric&gt; &lt;numeric&gt;
## Gene1       Gene1    939.23747             1 939.23747
## Gene2       Gene2    203.60925             1 203.60925
## Gene3       Gene3      2.24281             1   2.24281
## Gene4       Gene4     17.62236             1  17.62236
## Gene5       Gene5    369.72780             1 369.72780
## Gene6       Gene6     66.21670             1  66.21670</code></pre>
<div class="sourceCode" id="cb81"><pre class="downlit">
<span class="co"># Information about cells</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu">colData</span>(<span class="kw">sim</span>))
</pre></div>
<pre><code>## DataFrame with 6 rows and 3 columns
##              Cell       Batch ExpLibSize
##       &lt;character&gt; &lt;character&gt;  &lt;numeric&gt;
## Cell1       Cell1      Batch1     353497
## Cell2       Cell2      Batch1     358729
## Cell3       Cell3      Batch1     349884
## Cell4       Cell4      Batch1     367861
## Cell5       Cell5      Batch1     366083
## Cell6       Cell6      Batch1     363629</code></pre>
<div class="sourceCode" id="cb83"><pre class="downlit">
<span class="co"># Gene by cell matrices</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="fu">assays</span>(<span class="kw">sim</span>))
</pre></div>
<pre><code>## [1] "BatchCellMeans" "BaseCellMeans"  "BCV"            "CellMeans"     
## [5] "TrueCounts"     "counts"</code></pre>
<div class="sourceCode" id="cb85"><pre class="downlit">
<span class="co"># Example of cell means matrix</span>
<span class="fu">assays</span>(<span class="kw">sim</span>)<span class="op">$</span><span class="kw">CellMeans</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]
</pre></div>
<pre><code>##            Cell1       Cell2        Cell3       Cell4        Cell5
## Gene1 2859.61678 7931.063251 141.41041319 1452.355124 1.212197e+03
## Gene2  751.42990   51.296292 162.59405245  462.176041 9.106639e+02
## Gene3   23.39887   13.109097   0.05694822    8.839402 7.300158e-02
## Gene4   49.66024    1.827414  32.13648273   62.279860 1.579201e+02
## Gene5 1115.07426  582.986498 892.65931311  173.049967 1.465138e+03</code></pre>
<p>An additional (big) advantage of outputting a <code>SingleCellExperiment</code> is that we get immediate access to other analysis packages, such as the plotting functions in <code>scater</code>. For example we can make a PCA plot:</p>
<div class="sourceCode" id="cb87"><pre class="downlit">
<span class="co"># Use scater to calculate logcounts</span>
<span class="kw">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/logNormCounts.html">logNormCounts</a></span>(<span class="kw">sim</span>)
<span class="co"># Plot PCA</span>
<span class="kw">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runPCA.html">runPCA</a></span>(<span class="kw">sim</span>)
<span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html">plotPCA</a></span>(<span class="kw">sim</span>)
</pre></div>
<p><img src="splatter_files/figure-html/pca-1.png" width="576" style="display: block; margin: auto;"></p>
<p>(<strong>NOTE:</strong> Your values and plots may look different as the simulation is random and produces different results each time it is run.)</p>
<p>For more details about the <code>SingleCellExperiment</code> object refer to the [vignette] <a href="https://bioconductor.org/packages/devel/bioc/vignettes/SingleCellExperiment/inst/doc/intro.html">SCE-vignette</a>. For information about what you can do with <code>scater</code> refer to the <code>scater</code> documentation and <a href="https://bioconductor.org/packages/release/bioc/vignettes/scater/inst/doc/vignette.html">vignette</a>.</p>
<p>The <code>splatSimulate</code> function outputs the following additional information about the simulation:</p>
<ul>
<li>
<strong>Cell information (<code>colData</code>)</strong>
<ul>
<li>
<code>Cell</code> - Unique cell identifier.</li>
<li>
<code>Group</code> - The group or path the cell belongs to.</li>
<li>
<code>ExpLibSize</code> - The expected library size for that cell.</li>
<li>
<code>Step</code> (paths only) - How far along the path each cell is.</li>
</ul>
</li>
<li>
<strong>Gene information (<code>rowData</code>)</strong>
<ul>
<li>
<code>Gene</code> - Unique gene identifier.</li>
<li>
<code>BaseGeneMean</code> - The base expression level for that gene.</li>
<li>
<code>OutlierFactor</code> - Expression outlier factor for that gene (1 is not an outlier).</li>
<li>
<code>GeneMean</code> - Expression level after applying outlier factors.</li>
<li>
<code>DEFac[Group]</code> - The differential expression factor for each gene in a particular group (1 is not differentially expressed).</li>
<li>
<code>GeneMean[Group]</code> - Expression level of a gene in a particular group after applying differential expression factors.</li>
</ul>
</li>
<li>
<strong>Gene by cell information (<code>assays</code>)</strong>
<ul>
<li>
<code>BaseCellMeans</code> - The expression of genes in each cell adjusted for expected library size.</li>
<li>
<code>BCV</code> - The Biological Coefficient of Variation for each gene in each cell.</li>
<li>
<code>CellMeans</code> - The expression level of genes in each cell adjusted for BCV.</li>
<li>
<code>TrueCounts</code> - The simulated counts before dropout.</li>
<li>
<code>Dropout</code> - Logical matrix showing which counts have been dropped in which cells.</li>
</ul>
</li>
</ul>
<p>Values that have been added by Splatter are named using <code>UpperCamelCase</code> to separate them from the <code>underscore_naming</code> used by <code>scater</code> and other packages. For more information on the simulation see <code><a href="../reference/splatSimulate.html">?splatSimulate</a></code>.</p>
<div id="simulating-groups" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-groups" class="anchor"></a>Simulating groups</h2>
<p>So far we have only simulated a single population of cells but often we are interested in investigating a mixed population of cells and looking to see what cell types are present or what differences there are between them. Splatter is able to simulate these situations by changing the <code>method</code> argument Here we are going to simulate two groups, by specifying the <code>group.prob</code> parameter and setting the <code>method</code> parameter to <code>"groups"</code>:</p>
<p>(<strong>NOTE:</strong> We have also set the <code>verbose</code> argument to <code>FALSE</code> to stop Splatter printing progress messages.)</p>
<div class="sourceCode" id="cb88"><pre class="downlit">
<span class="kw">sim.groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/splatSimulate.html">splatSimulate</a></span>(group.prob = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>), method = <span class="st">"groups"</span>,
                            verbose = <span class="fl">FALSE</span>)
<span class="kw">sim.groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/logNormCounts.html">logNormCounts</a></span>(<span class="kw">sim.groups</span>)
<span class="kw">sim.groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runPCA.html">runPCA</a></span>(<span class="kw">sim.groups</span>)
<span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html">plotPCA</a></span>(<span class="kw">sim.groups</span>, colour_by = <span class="st">"Group"</span>)
</pre></div>
<p><img src="splatter_files/figure-html/groups-1.png" width="576" style="display: block; margin: auto;"></p>
<p>As we have set both the group probabilities to 0.5 we should get approximately equal numbers of cells in each group (around 50 in this case). If we wanted uneven groups we could set <code>group.prob</code> to any set of probabilities that sum to 1.</p>
</div>
<div id="simulating-paths" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-paths" class="anchor"></a>Simulating paths</h2>
<p>The other situation that is often of interest is a differentiation process where one cell type is changing into another. Splatter approximates this process by simulating a series of steps between two groups and randomly assigning each cell to a step. We can create this kind of simulation using the <code>"paths"</code> method.</p>
<div class="sourceCode" id="cb89"><pre class="downlit">
<span class="kw">sim.paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/splatSimulate.html">splatSimulate</a></span>(de.prob = <span class="fl">0.2</span>, nGenes = <span class="fl">1000</span>, method = <span class="st">"paths"</span>,
                           verbose = <span class="fl">FALSE</span>)
<span class="kw">sim.paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/logNormCounts.html">logNormCounts</a></span>(<span class="kw">sim.paths</span>)
<span class="kw">sim.paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runPCA.html">runPCA</a></span>(<span class="kw">sim.paths</span>)
<span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html">plotPCA</a></span>(<span class="kw">sim.paths</span>, colour_by = <span class="st">"Step"</span>)
</pre></div>
<p><img src="splatter_files/figure-html/paths-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Here the colours represent the “step” of each cell or how far along the differentiation path it is. We can see that the cells with dark colours are more similar to the originating cell type and the light coloured cells are closer to the final, differentiated, cell type. By setting additional parameters it is possible to simulate more complex process (for example multiple mature cell types from a single progenitor).</p>
</div>
<div id="batch-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#batch-effects" class="anchor"></a>Batch effects</h2>
<p>Another factor that is important in the analysis of any sequencing experiment are batch effects, technical variation that is common to a set of samples processed at the same time. We apply batch effects by telling Splatter how many cells are in each batch:</p>
<div class="sourceCode" id="cb90"><pre class="downlit">
<span class="kw">sim.batches</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/splatSimulate.html">splatSimulate</a></span>(batchCells = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">50</span>, <span class="fl">50</span>), verbose = <span class="fl">FALSE</span>)
<span class="kw">sim.batches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/logNormCounts.html">logNormCounts</a></span>(<span class="kw">sim.batches</span>)
<span class="kw">sim.batches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runPCA.html">runPCA</a></span>(<span class="kw">sim.batches</span>)
<span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html">plotPCA</a></span>(<span class="kw">sim.batches</span>, colour_by = <span class="st">"Batch"</span>)
</pre></div>
<p><img src="splatter_files/figure-html/batches-1.png" width="576" style="display: block; margin: auto;"></p>
<p>This looks at lot like when we simulated groups and that is because the process is very similar. The difference is that batch effects are applied to all genes, not just those that are differentially expressed, and the effects are usually smaller. By combining groups and batches we can simulate both unwanted variation that we aren’t interested in (batch) and the wanted variation we are looking for (group):</p>
<div class="sourceCode" id="cb91"><pre class="downlit">
<span class="kw">sim.groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/splatSimulate.html">splatSimulate</a></span>(batchCells = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">50</span>, <span class="fl">50</span>), group.prob = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>),
                            method = <span class="st">"groups"</span>, verbose = <span class="fl">FALSE</span>)
<span class="kw">sim.groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/logNormCounts.html">logNormCounts</a></span>(<span class="kw">sim.groups</span>)
<span class="kw">sim.groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runPCA.html">runPCA</a></span>(<span class="kw">sim.groups</span>)
<span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html">plotPCA</a></span>(<span class="kw">sim.groups</span>, shape_by = <span class="st">"Batch"</span>, colour_by = <span class="st">"Group"</span>)
</pre></div>
<p><img src="splatter_files/figure-html/batch-groups-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Here we see that the effects of the group (first component) are stronger than the batch effects (second component) but by adjusting the parameters we could made the batch effects dominate.</p>
</div>
<div id="convenience-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#convenience-functions" class="anchor"></a>Convenience functions</h2>
<p>Each of the Splatter simulation methods has it’s own convenience function. To simulate a single population use <code><a href="../reference/splatSimulate.html">splatSimulateSingle()</a></code> (equivalent to <code><a href="../reference/splatSimulate.html">splatSimulate(method = "single")</a></code>), to simulate groups use <code><a href="../reference/splatSimulate.html">splatSimulateGroups()</a></code> (equivalent to <code><a href="../reference/splatSimulate.html">splatSimulate(method = "groups")</a></code>) or to simulate paths use <code><a href="../reference/splatSimulate.html">splatSimulatePaths()</a></code> (equivalent to <code><a href="../reference/splatSimulate.html">splatSimulate(method = "paths")</a></code>).</p>
</div>
</div>
<div id="other-simulations" class="section level1">
<h1 class="hasAnchor">
<a href="#other-simulations" class="anchor"></a>Other simulations</h1>
<p>As well as it’s own Splat simulation method the Splatter package contains implementations of other single-cell RNA-seq simulations that have been published or wrappers around simulations included in other packages. To see all the available simulations run the <code><a href="../reference/listSims.html">listSims()</a></code> function:</p>
<div class="sourceCode" id="cb92"><pre class="downlit">
<span class="fu"><a href="../reference/listSims.html">listSims</a></span>()
</pre></div>
<pre><code>## Splatter currently contains 14 simulations 
## 
## Splat (splat) 
## DOI: 10.1186/s13059-017-1305-0    GitHub: Oshlack/splatter 
## The Splat simulation generates means from a gamma distribution, adjusts them for BCV and generates counts from a gamma-poisson. Dropout and batch effects can be optionally added. 
## 
## Splat Single (splatSingle) 
## DOI: 10.1186/s13059-017-1305-0    GitHub: Oshlack/splatter 
## The Splat simulation with a single population. 
## 
## Splat Groups (splatGroups) 
## DOI: 10.1186/s13059-017-1305-0    GitHub: Oshlack/splatter 
## The Splat simulation with multiple groups. Each group can have it's own differential expression probability and fold change distribution. 
## 
## Splat Paths (splatPaths) 
## DOI: 10.1186/s13059-017-1305-0    GitHub: Oshlack/splatter 
## The Splat simulation with differentiation paths. Each path can have it's own length, skew and probability. Genes can change in non-linear ways. 
## 
## Kersplat (kersplat) 
## DOI:      GitHub: Oshlack/splatter 
## The Kersplat simulation extends the Splat model by adding a gene network, more complex cell structure, doublets and empty cells (Experimental). 
## 
## Simple (simple) 
## DOI: 10.1186/s13059-017-1305-0    GitHub: Oshlack/splatter 
## A simple simulation with gamma means and negative binomial counts. 
## 
## Lun (lun) 
## DOI: 10.1186/s13059-016-0947-7    GitHub: MarioniLab/Deconvolution2016 
## Gamma distributed means and negative binomial counts. Cells are given a size factor and differential expression can be simulated with fixed fold changes. 
## 
## Lun 2 (lun2) 
## DOI: 10.1093/biostatistics/kxw055     GitHub: MarioniLab/PlateEffects2016 
## Negative binomial counts where the means and dispersions have been sampled from a real dataset. The core feature of the Lun 2 simulation is the addition of plate effects. Differential expression can be added between two groups of plates and optionally a zero-inflated negative-binomial can be used. 
## 
## scDD (scDD) 
## DOI: 10.1186/s13059-016-1077-y    GitHub: kdkorthauer/scDD 
## The scDD simulation samples a given dataset and can simulate differentially expressed and differentially distributed genes between two conditions. 
## 
## BASiCS (BASiCS) 
## DOI: 10.1371/journal.pcbi.1004333     GitHub: catavallejos/BASiCS 
## The BASiCS simulation is based on a bayesian model used to deconvolve biological and technical variation and includes spike-ins and batch effects. 
## 
## mfa (mfa) 
## DOI: 10.12688/wellcomeopenres.11087.1     GitHub: kieranrcampbell/mfa 
## The mfa simulation produces a bifurcating pseudotime trajectory. This can optionally include genes with transient changes in expression and added dropout. 
## 
## PhenoPath (pheno) 
## DOI: 10.1101/159913   GitHub: kieranrcampbell/phenopath 
## The PhenoPath simulation produces a pseudotime trajectory with different types of genes. 
## 
## ZINB-WaVE (zinb) 
## DOI: 10.1101/125112   GitHub: drisso/zinbwave 
## The ZINB-WaVE simulation simulates counts from a sophisticated zero-inflated negative-binomial distribution including cell and gene-level covariates. 
## 
## SparseDC (sparseDC) 
## DOI: 10.1093/nar/gkx1113      GitHub: cran/SparseDC 
## The SparseDC simulation simulates a set of clusters across two conditions, where some clusters may be present in only one condition.</code></pre>
<p>Each simulation has it’s own prefix which gives the name of the functions associated with that simulation. For example the prefix for the simple simulation is <code>simple</code> so it would store it’s parameters in a <code>SimpleParams</code> object that can be created using <code><a href="../reference/newParams.html">newSimpleParams()</a></code> or estimated from real data using <code><a href="../reference/simpleEstimate.html">simpleEstimate()</a></code>. To simulate data using that simulation you would use <code><a href="../reference/simpleSimulate.html">simpleSimulate()</a></code>. Each simulation returns a <code>SingleCellExperiment</code> object with intermediate values similar to that returned by <code><a href="../reference/splatSimulate.html">splatSimulate()</a></code>. For more detailed information on each simulation see the appropriate help page (eg. <code><a href="../reference/simpleSimulate.html">?simpleSimulate</a></code> for information on how the simple simulation works or <code><a href="../reference/lun2Estimate.html">? lun2Estimate</a></code> for details of how the Lun 2 simulation estimates parameters) or refer to the appropriate paper or package.</p>
</div>
<div id="other-expression-values" class="section level1">
<h1 class="hasAnchor">
<a href="#other-expression-values" class="anchor"></a>Other expression values</h1>
<p>Splatter is designed to simulate count data but some analysis methods expect other expression values, particularly length-normalised values such as TPM or FPKM. The <code>scater</code> package has functions for adding these values to a <code>SingleCellExperiment</code> object but they require a length for each gene. The <code>addGeneLengths</code> function can be used to simulate these lengths:</p>
<div class="sourceCode" id="cb94"><pre class="downlit">
<span class="kw">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simpleSimulate.html">simpleSimulate</a></span>(verbose = <span class="fl">FALSE</span>)
<span class="kw">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addGeneLengths.html">addGeneLengths</a></span>(<span class="kw">sim</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu">rowData</span>(<span class="kw">sim</span>))
</pre></div>
<pre><code>## DataFrame with 6 rows and 3 columns
##              Gene   GeneMean    Length
##       &lt;character&gt;  &lt;numeric&gt; &lt;numeric&gt;
## Gene1       Gene1 0.39274964      4891
## Gene2       Gene2 2.48067014      2804
## Gene3       Gene3 1.96955391      1325
## Gene4       Gene4 0.00337284      2314
## Gene5       Gene5 1.01863282      6135
## Gene6       Gene6 0.05567822      9756</code></pre>
<p>We can then use <code>scater</code> to calculate TPM:</p>
<div class="sourceCode" id="cb96"><pre class="downlit">
<span class="fu">tpm</span>(<span class="kw">sim</span>) <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/calculateTPM.html">calculateTPM</a></span>(<span class="kw">sim</span>, <span class="fu">rowData</span>(<span class="kw">sim</span>)<span class="op">$</span><span class="kw">Length</span>)
<span class="fu">tpm</span>(<span class="kw">sim</span>)[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]
</pre></div>
<pre><code>##           Cell1     Cell2     Cell3     Cell4    Cell5
## Gene1   0.00000  33.58752   0.00000  67.44956   0.0000
## Gene2  59.29454 234.34603 119.46946 235.30372   0.0000
## Gene3 250.96136 123.98232 126.41221 248.97797 506.5349
## Gene4   0.00000   0.00000   0.00000   0.00000   0.0000
## Gene5  81.30166  26.77695  27.30174   0.00000   0.0000</code></pre>
<p>The default method used by <code>addGeneLengths</code> to simulate lengths is to generate values from a log-normal distribution which are then rounded to give an integer length. The parameters for this distribution are based on human protein coding genes but can be adjusted if needed (for example for other species). Alternatively lengths can be sampled from a provided vector (see <code><a href="../reference/addGeneLengths.html">?addGeneLengths</a></code> for details and an example).</p>
</div>
<div id="comparing-simulations-and-real-data" class="section level1">
<h1 class="hasAnchor">
<a href="#comparing-simulations-and-real-data" class="anchor"></a>Comparing simulations and real data</h1>
<p>One thing you might like to do after simulating data is to compare it to a real dataset, or compare simulations with different parameters or models. Splatter provides a function <code>compareSCEs</code> that aims to make these comparisons easier. As the name suggests this function takes a list of <code>SingleCellExperiment</code> objects, combines the datasets and produces some plots comparing them. Let’s make two small simulations and see how they compare.</p>
<div class="sourceCode" id="cb98"><pre class="downlit">
<span class="kw">sim1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/splatSimulate.html">splatSimulate</a></span>(nGenes = <span class="fl">1000</span>, batchCells = <span class="fl">20</span>, verbose = <span class="fl">FALSE</span>)
<span class="kw">sim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simpleSimulate.html">simpleSimulate</a></span>(nGenes = <span class="fl">1000</span>, nCells = <span class="fl">20</span>, verbose = <span class="fl">FALSE</span>)
<span class="kw">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compareSCEs.html">compareSCEs</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(Splat = <span class="kw">sim1</span>, Simple = <span class="kw">sim2</span>))

<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">comparison</span>)
</pre></div>
<pre><code>## [1] "RowData" "ColData" "Plots"</code></pre>
<div class="sourceCode" id="cb100"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">comparison</span><span class="op">$</span><span class="kw">Plots</span>)
</pre></div>
<pre><code>## [1] "Means"        "Variances"    "MeanVar"      "LibrarySizes" "ZerosGene"   
## [6] "ZerosCell"    "MeanZeros"    "VarGeneCor"</code></pre>
<p>The returned list has three items. The first two are the combined datasets by gene (<code>RowData</code>) and by cell (<code>ColData</code>) and the third contains some comparison plots (produced using <code>ggplot2</code>), for example a plot of the distribution of means:</p>
<div class="sourceCode" id="cb102"><pre class="downlit">
<span class="kw">comparison</span><span class="op">$</span><span class="kw">Plots</span><span class="op">$</span><span class="kw">Means</span>
</pre></div>
<p><img src="splatter_files/figure-html/comparison-means-1.png" width="576" style="display: block; margin: auto;"></p>
<p>These are only a few of the plots you might want to consider but it should be easy to make more using the returned data. For example, we could plot the number of expressed genes against the library size:</p>
<div class="sourceCode" id="cb103"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="http://ggplot2.tidyverse.org">"ggplot2"</a></span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">comparison</span><span class="op">$</span><span class="kw">ColData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">sum</span>, y = <span class="kw">detected</span>, colour = <span class="kw">Dataset</span>)) <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>()
</pre></div>
<p><img src="splatter_files/figure-html/comparison-libsize-features-1.png" width="576" style="display: block; margin: auto;"></p>
<div id="comparing-differences" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-differences" class="anchor"></a>Comparing differences</h2>
<p>Sometimes instead of visually comparing datasets it may be more interesting to look at the differences between them. We can do this using the <code>diffSCEs</code> function. Similar to <code>compareSCEs</code> this function takes a list of <code>SingleCellExperiment</code> objects but now we also specify one to be a reference. A series of similar plots are returned but instead of showing the overall distributions they demonstrate differences from the reference.</p>
<div class="sourceCode" id="cb104"><pre class="downlit">
<span class="kw">difference</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diffSCEs.html">diffSCEs</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(Splat = <span class="kw">sim1</span>, Simple = <span class="kw">sim2</span>), ref = <span class="st">"Simple"</span>)
<span class="kw">difference</span><span class="op">$</span><span class="kw">Plots</span><span class="op">$</span><span class="kw">Means</span>
</pre></div>
<p><img src="splatter_files/figure-html/difference-1.png" width="576" style="display: block; margin: auto;"></p>
<p>We also get a series of Quantile-Quantile plot that can be used to compare distributions.</p>
<div class="sourceCode" id="cb105"><pre class="downlit">
<span class="kw">difference</span><span class="op">$</span><span class="kw">QQPlots</span><span class="op">$</span><span class="kw">Means</span>
</pre></div>
<p><img src="splatter_files/figure-html/difference-qq-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="making-panels" class="section level2">
<h2 class="hasAnchor">
<a href="#making-panels" class="anchor"></a>Making panels</h2>
<p>Each of these comparisons makes several plots which can be a lot to look at. To make this easier, or to produce figures for publications, you can make use of the functions <code>makeCompPanel</code>, <code>makeDiffPanel</code> and <code>makeOverallPanel</code>.</p>
<p>These functions combine the plots into a single panel using the <code>cowplot</code> package. The panels can be quite large and hard to view (for example in RStudio’s plot viewer) so it can be better to output the panels and view them separately. Luckily <code>cowplot</code> provides a convenient function for saving the images. Here are some suggested parameters for outputting each of the panels:</p>
<div class="sourceCode" id="cb106"><pre class="downlit">
<span class="co"># This code is just an example and is not run</span>
<span class="kw">panel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeCompPanel.html">makeCompPanel</a></span>(<span class="kw">comparison</span>)
<span class="kw">cowplot</span>::<span class="fu"><a href="https://rdrr.io/pkg/cowplot/man/save_plot.html">save_plot</a></span>(<span class="st">"comp_panel.png"</span>, <span class="kw">panel</span>, nrow = <span class="fl">4</span>, ncol = <span class="fl">3</span>)

<span class="kw">panel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeDiffPanel.html">makeDiffPanel</a></span>(<span class="kw">difference</span>)
<span class="kw">cowplot</span>::<span class="fu"><a href="https://rdrr.io/pkg/cowplot/man/save_plot.html">save_plot</a></span>(<span class="st">"diff_panel.png"</span>, <span class="kw">panel</span>, nrow = <span class="fl">3</span>, ncol = <span class="fl">5</span>)

<span class="kw">panel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeOverallPanel.html">makeOverallPanel</a></span>(<span class="kw">comparison</span>, <span class="kw">difference</span>)
<span class="kw">cowplot</span>::<span class="fu"><a href="https://rdrr.io/pkg/cowplot/man/save_plot.html">save_plot</a></span>(<span class="st">"overall_panel.png"</span>, <span class="kw">panel</span>, ncol = <span class="fl">4</span>, nrow = <span class="fl">7</span>)
</pre></div>
</div>
</div>
<div id="citing-splatter" class="section level1">
<h1 class="hasAnchor">
<a href="#citing-splatter" class="anchor"></a>Citing Splatter</h1>
<p>If you use Splatter in your work please cite our paper:</p>
<div class="sourceCode" id="cb107"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/citation.html">citation</a></span>(<span class="st">"splatter"</span>)
</pre></div>
<pre><code>## 
##   Zappia L, Phipson B, Oshlack A. Splatter: Simulation of single-cell
##   RNA sequencing data. Genome Biology. 2017;
##   doi:10.1186/s13059-017-1305-0
## 
## A BibTeX entry for LaTeX users is
## 
##   @Article{,
##     author = {Luke Zappia and Belinda Phipson and Alicia Oshlack},
##     title = {Splatter: simulation of single-cell RNA sequencing data},
##     journal = {Genome Biology},
##     year = {2017},
##     url = {http://dx.doi.org/10.1186/s13059-017-1305-0},
##     doi = {10.1186/s13059-017-1305-0},
##   }</code></pre>
</div>
<div id="session-information" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#session-information" class="anchor"></a>Session information</h1>
<div class="sourceCode" id="cb109"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>()
</pre></div>
<pre><code>## R version 4.0.2 Patched (2020-09-24 r79253)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.1 LTS
## 
## Matrix products: default
## BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.8.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] parallel  stats4    stats     graphics  grDevices utils     datasets 
## [8] methods   base     
## 
## other attached packages:
##  [1] scater_1.17.5               ggplot2_3.3.2              
##  [3] splatter_1.13.0             SingleCellExperiment_1.11.7
##  [5] SummarizedExperiment_1.19.6 DelayedArray_0.15.9        
##  [7] matrixStats_0.56.0          Matrix_1.2-18              
##  [9] Biobase_2.49.1              GenomicRanges_1.41.6       
## [11] GenomeInfoDb_1.25.11        IRanges_2.23.10            
## [13] S4Vectors_0.27.13           BiocGenerics_0.35.4        
## [15] BiocStyle_2.17.1           
## 
## loaded via a namespace (and not attached):
##  [1] bitops_1.0-6              fs_1.5.0                 
##  [3] RColorBrewer_1.1-2        rprojroot_1.3-2          
##  [5] tools_4.0.2               backports_1.1.10         
##  [7] R6_2.4.1                  irlba_2.3.3              
##  [9] vipor_0.4.5               colorspace_1.4-1         
## [11] withr_2.3.0               sp_1.4-2                 
## [13] tidyselect_1.1.0          gridExtra_2.3            
## [15] compiler_4.0.2            BiocNeighbors_1.7.0      
## [17] desc_1.2.0                labeling_0.3             
## [19] bookdown_0.20             scales_1.1.1             
## [21] checkmate_2.0.0           pkgdown_1.6.1.9000       
## [23] systemfonts_0.3.1         stringr_1.4.0            
## [25] digest_0.6.25             rmarkdown_2.3            
## [27] XVector_0.29.3            pkgconfig_2.0.3          
## [29] htmltools_0.5.0           akima_0.6-2.1            
## [31] limma_3.45.14             rlang_0.4.7              
## [33] DelayedMatrixStats_1.11.1 generics_0.0.2           
## [35] farver_2.0.3              BiocParallel_1.23.2      
## [37] dplyr_1.0.2               RCurl_1.98-1.2           
## [39] magrittr_1.5              BiocSingular_1.5.1       
## [41] GenomeInfoDbData_1.2.3    scuttle_0.99.14          
## [43] Rcpp_1.0.5                ggbeeswarm_0.6.0         
## [45] munsell_0.5.0             viridis_0.5.1            
## [47] lifecycle_0.2.0           stringi_1.5.3            
## [49] yaml_2.2.1                edgeR_3.31.4             
## [51] MASS_7.3-53               zlibbioc_1.35.0          
## [53] grid_4.0.2                crayon_1.3.4             
## [55] lattice_0.20-41           cowplot_1.1.0            
## [57] beachmat_2.5.5            splines_4.0.2            
## [59] locfit_1.5-9.4            knitr_1.30               
## [61] pillar_1.4.6              glue_1.4.2               
## [63] evaluate_0.14             BiocManager_1.30.10      
## [65] vctrs_0.3.4               gtable_0.3.0             
## [67] purrr_0.3.4               assertthat_0.2.1         
## [69] cpp11_0.2.1               xfun_0.17                
## [71] rsvd_1.0.3                ragg_0.3.1               
## [73] survival_3.2-3            viridisLite_0.3.0        
## [75] tibble_3.0.3              beeswarm_0.2.3           
## [77] memoise_1.1.0             fitdistrplus_1.1-1       
## [79] ellipsis_0.3.1</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Luke Zappia, Belinda Phipson, Alicia Oshlack.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
